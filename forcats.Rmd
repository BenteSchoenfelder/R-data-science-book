# Categorical data: forcats {#forcats}

## Introduction
This chapter is dedicated to the handling of categorical variables. This becomes important if information is to be presented in a non-alphabetical order or aggregated in a meaningful way. Within the R programming language, categorical variables are converted into a form that can be used for analysis using factors. While many Base-R functions automatically convert character vectors into factors, tidyverse requires an explicit treatment. The core-tidyverse provides the package forcats, which will be described here. Further information and exercises are available at the sources shown.

Resources:

- [Homepage](https://forcats.tidyverse.org/)
- [Cheatsheet](https://github.com/rstudio/cheatsheets/raw/master/factors.pdf)
- [Chapter in R4DS](https://r4ds.had.co.nz/factors.html)
- [Vignette](https://forcats.tidyverse.org/articles/forcats.html)

In this chapter the demo data set "diamonds" from the ggplot2-package ([more information](https://ggplot2.tidyverse.org/reference/diamonds.html)) and a dataset "olympic-games" which shows the medal success of olympic athletes from 1896 to 2016 are used. Before you start reading, you should have read the chapter ***Wrangling Data: dplyr*** or already have basic knowledge in this field. 

```{r message=FALSE, warning=FALSE, paged.print=TRUE}
library(tidyverse)
diamonds<-read_csv("data/diamonds.csv")
olympic<-read_csv("data/olympic-games.csv")

head(diamonds)
head(olympic)
```

## General functions
### Create
Basically two things are needed to create a factor. A vector which contains the values to be analyzed and a vector which divides the values into levels. As an example we will use the column "clarity" of the diamonds dataset. It is a categorical evaluation of the clarity of a diamond (I1 (worst), SI2, SI1, VS2, VS1, VVS2, VVS1, IF (best)). If you are interested in the distribution of the diamonds in this category, you could do this by using a suitable query:

```{r}
diamonds%>%
  group_by(clarity)%>%
  count()%>%
  ggplot(aes(clarity, n))+
  geom_col()
```

A sorting of the x-axis, which is based on the degree of clarity, is unfortunately not possible in this form. A workaround is to convert this column into a factor, which allows us to evaluate the individual categories. For this purpose we first define a vector, which ranks the categories according to their value:

```{r}
levels_clarity<-c("I1", "SI2", "SI1", "VS2", "VS1", "VVS2", "VVS1", "IF")
```

In the next step we lay this newly created levels vector on the column "clarity" of our data set to create a factor. This is a base-R function.

```{r}
factor_clarity<-factor(x = diamonds$clarity, levels = levels_clarity)
```

Another possibility to create a factor is to convert a vector using ***as_factor().***. Here the levels are created automatically. Their order depends on the appearance of the corresponding value in the source vector.

```{r}
as_factor(diamonds$clarity)%>%
  levels()
```


### Count values per level
Now we repeat the analysis of the distribution within our dataset using the created factor. The function ***fct_count()*** returns the frequency of a categorical value within a factor. The order of the levels remains unchanged.

```{r}
fct_count(factor_clarity)%>%
  ggplot(aes(clarity, n))+          #the definition of aes. mapping in this line is only used to label the axes
  geom_col(aes(f, n))
```

It becomes obvious that the distribution can now be displayed in the desired order (by valence). Functions of the package forcats always start with the prefix ***fct_***. 

### Inspect and set levels
With the function ***levels()*** the levels of a factor can be both read and defined. ***But beware ***: this can only be used to change the names, not the order of the levels. The base-R function ***unclass()*** gives information about the internal memory structure of a factor.

```{r}
factor_clarity%>%levels()                   #shows the original levels of our factor
factor_clarity[1:25]%>%unclass()            #shows the internal structure
#remain the semantic order but replace the technical jargon with something understandable
levels(factor_clarity)<-c("c8", "c7", "c6", "c5", "c4", "c3", "c2", "c1")   
factor_clarity%>%head(25)
```

### Inspect unique values 
The function ***fct_unique*** can be used to output unique values of a factor. In contrast to the base-R function ***unique()*** the values are returned in the order of the levels and not in the order of their appearance.

```{r}
factor_clarity%>%fct_unique()
factor_clarity%>%unique()
```


## Combine factors
## Order of levels
## Value of levels
## Add or drop levels
