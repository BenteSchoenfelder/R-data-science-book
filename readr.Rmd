# Reading data: readr {#readr}


```{r message=FALSE, warning=FALSE}
library(readr)  # reading data (we could also load it via package tidyverse)
library(dplyr)  # wrangling data (we could also load it via package tidyverse) 
library(scales) # formatted Output (dates, currencies, ...)
```

We are working with crudly formatted contract data (_vertragsdaten.csv_), to demonstrate the functionalites of the `readr` package. This is how the data looks like:

```{r}
read_lines(file = "data/vertragsdaten.csv", n_max = 5)
```

The Challenges are:

- Add column names
- Deal with leading and trailing blanks (which can have a meaning in some columns)
- Correctly specify the column types (numbers, date, character, ...)
- To correctly identify numbers, we need to set the German locale. Itherwise, the decimal mark won't be correctly identified.
- In order to create readible reports, it is sometimes helpful to display Euro amounts not as a number, but as a character that includes the Euro symbol (â‚¬) and comma/big mark signs

```{r}
df <- read_delim(file = "data/vertragsdaten.csv", 
                 
                 # Specify semicolon as separator
                 delim = ";", 
                 
                 # Set the missing column names
                 col_names = c("VVT_NR", "Gebiet", "Abt", "Zw", "FK", "Beitr_Neu", "EDV_Dat", 
                               "Merkmal", "Kz_MB", "Sparte", "Bedingung", "leere_Spalte"),
                 
                 # Change data types which are not correctly imported by default
                 # We skip the last column, which turns out to be empty
                 col_types = cols(EDV_Dat = col_date(format = "%d%m%Y"), leere_Spalte = col_skip()), 
                 
                 # We set the German locale in order to get numbers and dates right
                 locale = locale(date_names = "de", decimal_mark = ",", grouping_mark = "."), 
                 
                 # White spaces are sometimes important, so we don't want to trim them
                 trim_ws = FALSE)


# We need a separate step to correct the column Beitr_Neu. 
# Here we need to trim the white spaces and again use the locale from above
df <- df %>% 
  mutate(Beitr_Neu = parse_number(Beitr_Neu, 
                                  locale = locale(date_names = "de", 
                                                  decimal_mark = ",", 
                                                  grouping_mark = ".",
                                                  encoding = "UTF-8"), 
                                  trim_ws = TRUE))

head(df)
```
